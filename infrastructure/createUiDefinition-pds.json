{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
            "basics": {
                "description": "Deploy the Policing Assistant solution with PDS-compliant naming conventions for all 44 UK police forces.",
                "location": {
                    "visible": true,
                    "allowedValues": [
                        "uksouth",
                        "ukwest",
                        "westeurope",
                        "northeurope"
                    ]
                }
            }
        },
        "basics": [
            {
                "name": "forceInfo",
                "type": "Microsoft.Common.Section",
                "label": "Police Force Configuration",
                "elements": [
                    {
                        "name": "forceCode",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Police Force Code",
                        "defaultValue": "btp",
                        "toolTip": "Enter your 2-3 character police force code (e.g., 'btp', 'met', 'gmp'). Must be lowercase letters only.",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z]{2,3}$",
                            "validationMessage": "Force code must be 2-3 lowercase letters only (e.g., 'btp', 'met', 'gmp')."
                        },
                        "visible": true
                    },
                    {
                        "name": "environment",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Environment",
                        "defaultValue": "Development",
                        "toolTip": "Select the deployment environment",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Development",
                                    "value": "dev"
                                },
                                {
                                    "label": "Test",
                                    "value": "test"
                                },
                                {
                                    "label": "Production",
                                    "value": "prod"
                                }
                            ],
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "instanceNumber",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Instance Number",
                        "defaultValue": "01",
                        "toolTip": "Enter a 2-digit instance number (01, 02, etc.) for resource uniqueness",
                        "constraints": {
                            "required": true,
                            "regex": "^[0-9]{2}$",
                            "validationMessage": "Instance number must be exactly 2 digits (e.g., '01', '02')."
                        },
                        "visible": true
                    }
                ],
                "visible": true
            }
        ],
        "steps": [
            {
                "name": "resourceNaming",
                "label": "Resource Naming",
                "elements": [
                    {
                        "name": "namingInfo",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "Resource names will be automatically generated following PDS naming standards. You can customize them if needed, but they must comply with PDS conventions."
                        }
                    },
                    {
                        "name": "webAppConfig",
                        "type": "Microsoft.Common.Section",
                        "label": "Web Application",
                        "elements": [
                            {
                                "name": "webAppName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Web App Name",
                                "defaultValue": "[concat(basics('forceInfo').forceCode, '-app-policing-', basics('forceInfo').environment, '-', basics('forceInfo').instanceNumber)]",
                                "toolTip": "Web application name following PDS format: {force-code}-app-policing-{environment}-{instance}",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9][a-z0-9\\-]{0,58}[a-z0-9]$",
                                    "validationMessage": "Web app name must be 2-60 characters, start/end with alphanumeric, contain only lowercase letters, numbers, and hyphens."
                                },
                                "visible": true
                            }
                        ],
                        "visible": true
                    },
                    {
                        "name": "searchConfig",
                        "type": "Microsoft.Common.Section",
                        "label": "Azure AI Search",
                        "elements": [
                            {
                                "name": "searchServiceName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Search Service Name",
                                "defaultValue": "[concat(basics('forceInfo').forceCode, '-srch-policing-', basics('forceInfo').environment, '-', basics('forceInfo').instanceNumber)]",
                                "toolTip": "Azure AI Search service name following PDS format: {force-code}-srch-policing-{environment}-{instance}",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9][a-z0-9\\-]{0,58}[a-z0-9]$",
                                    "validationMessage": "Search service name must be 2-60 characters, start/end with alphanumeric, contain only lowercase letters, numbers, and hyphens."
                                },
                                "visible": true
                            },
                            {
                                "name": "searchServiceSku",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Search Service SKU",
                                "defaultValue": "Standard",
                                "toolTip": "Select the pricing tier for Azure AI Search",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "Free",
                                            "value": "free"
                                        },
                                        {
                                            "label": "Basic",
                                            "value": "basic"
                                        },
                                        {
                                            "label": "Standard",
                                            "value": "standard"
                                        },
                                        {
                                            "label": "Standard 2",
                                            "value": "standard2"
                                        },
                                        {
                                            "label": "Standard 3",
                                            "value": "standard3"
                                        }
                                    ],
                                    "required": true
                                },
                                "visible": true
                            }
                        ],
                        "visible": true
                    },
                    {
                        "name": "aiConfig",
                        "type": "Microsoft.Common.Section",
                        "label": "Azure OpenAI",
                        "elements": [
                            {
                                "name": "openAIServiceName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "OpenAI Service Name",
                                "defaultValue": "[concat(basics('forceInfo').forceCode, '-ai-policing-', basics('forceInfo').environment, '-', basics('forceInfo').instanceNumber)]",
                                "toolTip": "Azure OpenAI service name following PDS format: {force-code}-ai-policing-{environment}-{instance}",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9][a-z0-9\\-]{0,62}[a-z0-9]$",
                                    "validationMessage": "OpenAI service name must be 2-64 characters, start/end with alphanumeric, contain only lowercase letters, numbers, and hyphens."
                                },
                                "visible": true
                            }
                        ],
                        "visible": true
                    },
                    {
                        "name": "storageConfig",
                        "type": "Microsoft.Common.Section",
                        "label": "Storage Account",
                        "elements": [
                            {
                                "name": "storageAccountName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Storage Account Name",
                                "defaultValue": "[take(concat('st', basics('forceInfo').forceCode, 'policing', basics('forceInfo').environment, basics('forceInfo').instanceNumber), 24)]",
                                "toolTip": "Storage account name following PDS format: st{forcecode}policing{environment}{instance}. Must be globally unique.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9]{3,24}$",
                                    "validationMessage": "Storage account name must be 3-24 characters, lowercase letters and numbers only."
                                },
                                "visible": true
                            }
                        ],
                        "visible": true
                    },
                    {
                        "name": "cosmosConfig",
                        "type": "Microsoft.Common.Section",
                        "label": "Cosmos DB",
                        "elements": [
                            {
                                "name": "cosmosDbAccountName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Cosmos DB Account Name",
                                "defaultValue": "[concat(basics('forceInfo').forceCode, '-cosmos-policing-', basics('forceInfo').environment, '-', basics('forceInfo').instanceNumber)]",
                                "toolTip": "Cosmos DB account name following PDS format: {force-code}-cosmos-policing-{environment}-{instance}",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9][a-z0-9\\-]{1,42}[a-z0-9]$",
                                    "validationMessage": "Cosmos DB account name must be 3-44 characters, start/end with alphanumeric, contain only lowercase letters, numbers, and hyphens."
                                },
                                "visible": true
                            }
                        ],
                        "visible": true
                    }
                ]
            },
            {
                "name": "searchComponents",
                "label": "Search Configuration",
                "elements": [
                    {
                        "name": "searchIndexConfig",
                        "type": "Microsoft.Common.Section",
                        "label": "Search Index Configuration",
                        "elements": [
                            {
                                "name": "searchIndexName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Search Index Name",
                                "defaultValue": "[concat(basics('forceInfo').forceCode, '-policing-index-', basics('forceInfo').environment)]",
                                "toolTip": "Name for the search index following PDS format",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9][a-z0-9\\-]{0,126}[a-z0-9]$",
                                    "validationMessage": "Search index name must be 1-128 characters, contain only lowercase letters, numbers, and hyphens."
                                },
                                "visible": true
                            },
                            {
                                "name": "searchIndexerName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Search Indexer Name",
                                "defaultValue": "[concat(basics('forceInfo').forceCode, '-policing-indexer-', basics('forceInfo').environment)]",
                                "toolTip": "Name for the search indexer following PDS format",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9][a-z0-9\\-]{0,126}[a-z0-9]$",
                                    "validationMessage": "Search indexer name must be 1-128 characters, contain only lowercase letters, numbers, and hyphens."
                                },
                                "visible": true
                            },
                            {
                                "name": "searchDataSourceName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Search Data Source Name",
                                "defaultValue": "[concat(basics('forceInfo').forceCode, '-policing-datasource-', basics('forceInfo').environment)]",
                                "toolTip": "Name for the search data source following PDS format",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9][a-z0-9\\-]{0,126}[a-z0-9]$",
                                    "validationMessage": "Search data source name must be 1-128 characters, contain only lowercase letters, numbers, and hyphens."
                                },
                                "visible": true
                            }
                        ],
                        "visible": true
                    }
                ]
            }
        ],
        "outputs": {
            "ForceCode": "[basics('forceInfo').forceCode]",
            "EnvironmentSuffix": "[basics('forceInfo').environment]",
            "InstanceNumber": "[basics('forceInfo').instanceNumber]",
            "WebAppName": "[steps('resourceNaming').webAppConfig.webAppName]",
            "SearchServiceName": "[steps('resourceNaming').searchConfig.searchServiceName]",
            "SearchServiceSku": "[steps('resourceNaming').searchConfig.searchServiceSku]",
            "OpenAIServiceName": "[steps('resourceNaming').aiConfig.openAIServiceName]",
            "StorageAccountName": "[steps('resourceNaming').storageConfig.storageAccountName]",
            "StorageContainerName": "docs",
            "CosmosDbAccountName": "[steps('resourceNaming').cosmosConfig.cosmosDbAccountName]",
            "SearchIndexName": "[steps('searchComponents').searchIndexConfig.searchIndexName]",
            "SearchIndexerName": "[steps('searchComponents').searchIndexConfig.searchIndexerName]",
            "SearchDataSourceName": "[steps('searchComponents').searchIndexConfig.searchDataSourceName]",
            "AzureOpenAIModelName": "gpt-4o",
            "AzureOpenAIEmbeddingName": "text-embedding-ada-002",
            "Location": "[location()]"
        }
    }
}
